
<!DOCTYPE html>

<html lang="en">

<head>

<meta charset="UTF-8" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Air Pollution Awareness</title>

<style>

  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;600&display=swap');

  body {

    margin: 0;

    font-family: 'Poppins', sans-serif;

    background: #f4f9ff;

    color: #222;

  }

  header {

    background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);

    padding: 1rem 2rem;

    position: sticky;

    top: 0;

    z-index: 1000;

    box-shadow: 0 2px 10px rgba(0,0,0,0.1);

  }

  header h1 {

    margin: 0;

    font-weight: 600;

    color: white;

    font-size: 1.8rem;

    letter-spacing: 0.05em;

  }

  nav {

    margin-top: 0.5rem;

  }

  nav button {

    background: transparent;

    border: none;

    color: white;

    font-weight: 600;

    margin-right: 1.5rem;

    padding: 8px 12px;

    font-size: 1rem;

    cursor: pointer;

    border-radius: 5px;

    transition: background-color 0.3s ease;

  }

  nav button:hover,

  nav button.active {

    background: rgba(255, 255, 255, 0.25);

  }

  main {

    padding: 2rem;

    max-width: 1000px;

    margin: 0 auto;

  }

  section {

    display: none;

  }

  section.active {

    display: block;

  }

  h2 {

    font-weight: 600;

    color: #1768ac;

    margin-bottom: 1rem;

  }

  /* Home Page Styles */

  #home p {

    font-size: 1.1rem;

    line-height: 1.6;

    margin-bottom: 1.2rem;

  }

  #home .callout {

    background: #caf0f8;

    border-left: 5px solid #0077b6;

    padding: 1rem 1.5rem;

    font-weight: 600;

    color: #023e8a;

    border-radius: 4px;

    margin-bottom: 2rem;

  }



  /* Stories Page */

  #stories article {

    background: white;

    border-radius: 8px;

    box-shadow: 0 1px 8px rgba(0,0,0,0.1);

    margin-bottom: 1.5rem;

    padding: 1.5rem;

  }

  #stories article h3 {

    margin-top: 0;

    color: #0077b6;

  }

  #stories article p {

    line-height: 1.5;

    font-size: 1rem;

    color: #444;

  }



  /* Statistics */

  #statistics #aqi-stats {

    margin-top: 1.5rem;

  }

  #statistics canvas {

    margin-top: 2rem;

    background: white;

    border-radius: 8px;

    box-shadow: 0 1px 8px rgba(0,0,0,0.1);

    padding: 1rem;

  }



  /* Map */

  #map {

    height: 500px;

    border-radius: 10px;

    box-shadow: 0 1px 12px rgba(0,0,0,0.15);

  }



  footer {

    text-align: center;

    padding: 1rem;

    color: #666;

    font-size: 0.9rem;

    background: #e1eaf5;

    margin-top: 3rem;

  }



  @media (max-width: 600px) {

    header h1 {

      font-size: 1.4rem;

    }

    nav button {

      margin-right: 1rem;

      font-size: 0.9rem;

      padding: 6px 10px;

    }

    main {

      padding: 1rem;

    }

  }

</style>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"

  integrity="sha256-sA+e2ye3W3hzvQ+cyQYbEyZveuTV2Vx1mZ9wQDeDNH8="

  crossorigin="" />

</head>

<body>

<header>

  <h1>Air Pollution Awareness</h1>

  <nav>

    <button id="nav-home" type="button" class="active">Home</button>

    <button id="nav-stories" type="button">Stories</button>

    <button id="nav-statistics" type="button">Statistics</button>

    <button id="nav-map" type="button">Map</button>

  </nav>

</header>

<main>

  <section id="home" class="active" aria-label="Home page">

    <div class="callout">

      Breathe Easy: Learn about air pollution and how you can help protect the planet!

    </div>

      <div style="display: flex; justify-content: center; padding: 20px;">
      <div id="climate-question" style="font-family: Arial, sans-serif; max-width: 400px; padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
      <label for="year-input" style="display:block; margin-bottom: 8px; font-weight: bold;">
        What year do you think scientists say is the point of no return from climate change?
      </label>
      <input type="number" id="year-input" placeholder="Enter a year" style="padding: 6px; width: 100%; box-sizing: border-box; margin-bottom: 10px;">
      <button id="submit-year" style="padding: 6px 12px; cursor: pointer;">Submit</button>
      
      <div id="result" style="margin-top: 15px; display:none; background:#e0f7fa; padding: 10px; border-radius: 4px;">
        <p><strong>Outcome year:</strong> 2035</p>
        <p>Scientists warn that by 2035, some climate effects may become irreversible if no strong actions are taken.</p>
        <ul>
          <li>Global temperatures could rise beyond 1.5°C above pre-industrial levels.</li>
          <li>Sea levels may rise significantly, impacting coastal cities.</li>
          <li>Increased frequency of extreme weather events like droughts and floods.</li>
        </ul>
        </div>
    </div>
      </div>
    </div>

    <script>
      document.getElementById('submit-year').addEventListener('click', function() {
        const userYear = document.getElementById('year-input').value.trim();
        if(!userYear) {
          alert('Please enter a year.');
          return;
        }
        document.getElementById('result').style.display = 'block';
      });
    </script>
  
    <p>Air pollution is one of the biggest environmental threats to human health worldwide. It is caused by harmful substances like particulate matter, nitrogen dioxide, carbon monoxide, and ozone.</p>

    <p>Exposure to polluted air leads to respiratory and cardiovascular diseases, reduced lung function, and premature death. Children, elderly, and those with pre-existing health conditions are especially vulnerable.</p>

    <p>Raising awareness and taking collective action can help reduce emissions and improve air quality for a healthier future.</p>

    <p>Use the tabs above to explore real-time air quality data, inspiring stories, and an interactive map displaying current air pollution levels around the world.</p>

  </section>



  <section id="stories" aria-label="Stories page">

    <h2>Stories from Around the World</h2>

    <article>

      <h3>Story of Ella Adoo-Kissi-Debrah</h3>

      <p>Ella Adoo-Kissi-Debrah was a nine-year-old girl from southeast London who tragically died in 2013 following a severe asthma attack. Her family lived just 25 meters from the South Circular Road, an area known for high traffic emissions. In a groundbreaking legal decision, a UK coroner concluded that air pollution was a significant factor in Ella's death, marking the first time in the UK that air pollution was officially listed as a cause of death on a death certificate. 

      Following this, the UK government issued an apology and reached a settlement with Ella's family, acknowledging failures in addressing air pollution levels and insufficient communication about the associated health risks. Ella's mother, Rosamund Adoo-Kissi-Debrah, has since become a prominent environmental campaigner, advocating for stricter air quality laws to protect public health.</p>

      <div style="text-align: center;">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTmk7Ehl3UM0REwCUjGqIq53eeBQmKjQc9ZzQ&s"alt="Ella Adoo-Kissi-Debrah" 
       width="500">
      </div>

      
    </article>

    <article>

      <h3>Air Pollution in Melbourne's Inner West</h3>

      <p>In Melbourne's inner western suburbs—such as Yarraville, Footscray, and Maribyrnong—residents have long been exposed to elevated levels of air pollution, primarily due to heavy traffic and industrial activities. This exposure has led to significant health issues within the community.

      A 2020 Victorian Government report revealed that this region had the highest rate of childhood asthma in the state and higher-than-average hospital admissions for diseases linked to air pollution, including heart disease, lung cancer, and stroke. 

      Health scientist Clare Walter conducted a study using data from air-quality monitors installed as part of the West Gate Tunnel project. Her research found that nitrogen dioxide levels—a pollutant closely associated with traffic emissions were 50% higher at roadside locations compared to background levels. This increased exposure raised the risk of children developing asthma by up to 13% and increased the chance of a child with asthma experiencing the illness by 33%. 

      Despite these alarming findings, there has been a lack of accessible information for the local community. The 2020 report noted that current reporting is primarily on websites, which are not accessible for many community members, and the language in the reports is highly technical</p>


      <div style="text-align: center;">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS0uoFSiyg608LSUo7GL0VMBfEzimEamXDvUw&s"alt="Melbourne Inner West Pollution" 
       width="500">
      </div>

    </article>

    <article>

      <h3>How You Can Contribute</h3>

      <div style="text-align: center;">
        <iframe width="560" height="315" 
          src="https://www.youtube.com/embed/zste8smMudE" 
          title="YouTube video player" 
          frameborder="0" 
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
          allowfullscreen>
        </iframe>
      </div>
     
     <div
<section id="reduce-pollution-tutorial">
  <h2>Step-by-Step Guide: How to Reduce Air Pollution</h2>
  <p>Follow these steps to make a positive impact. Tick off each action as you go!</p>

  <ul id="pollutionChecklist" style="list-style: none; padding-left: 0;">
    <li>
      <label>
        <input type="checkbox" onchange="enableNext(this)">
        🚶 Walk, bike, or use public transport instead of driving
      </label>
    </li>
    <li>
      <label>
        <input type="checkbox" disabled onchange="enableNext(this)">
        💡 Turn off lights and electronics when not in use
      </label>
    </li>
    <li>
      <label>
        <input type="checkbox" disabled onchange="enableNext(this)">
        🔌 Use energy-efficient appliances (e.g. LED bulbs, smart plugs)
      </label>
    </li>
    <li>
      <label>
        <input type="checkbox" disabled onchange="enableNext(this)">
        ♻️ Reduce, reuse, recycle and avoid single-use plastics
      </label>
    </li>
    <li>
      <label>
        <input type="checkbox" disabled onchange="enableNext(this)">
        🌳 Plant a tree or support reforestation efforts
      </label>
    </li>
    <li>
      <label>
        <input type="checkbox" disabled onchange="enableNext(this)">
        🗣️ Educate others about air pollution and sustainable habits
      </label>
    </li>
  </ul>

  <div id="congratsMessage" style="display: none; margin-top: 20px; padding: 10px; background-color: #e6ffe6; border: 1px solid #8bc34a; border-radius: 5px;">
    🎉 <strong>Congratulations!</strong> You're one step closer to lowering air pollution and making the world a cleaner place. Keep it up! 
  </div>
</section>

<script>
  function enableNext(checkbox) {
    if (checkbox.checked) {
      const currentItem = checkbox.closest('li');
      const nextItem = currentItem.nextElementSibling;
      if (nextItem) {
        const nextCheckbox = nextItem.querySelector('input[type="checkbox"]');
        nextCheckbox.disabled = false;
        nextCheckbox.focus();
      }
      checkAllCompleted();
    }
  }

  function checkAllCompleted() {
    const checkboxes = document.querySelectorAll('#pollutionChecklist input[type="checkbox"]');
    const allChecked = Array.from(checkboxes).every(cb => cb.checked);
    if (allChecked) {
      document.getElementById('congratsMessage').style.display = 'block';
    }
  }
</script>



    </article>

  </section>



  <section id="statistics" aria-label="Statistics page">

    <h2>Global Air Quality Statistics</h2>

    <p>Below are live statistics fetched from Air Quality Index data for selected major cities.</p>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<canvas id="pollutionChart"></canvas>

  <script>
    const ctx = document.getElementById('pollutionChart').getContext('2d');
    const years = Array.from({ length: 15 }, (_, i) => 2010 + i);

    const data = {
      labels: years,
      datasets: [
        {
          label: 'India',
          data: [60, 62, 63, 65, 66, 67, 69, 70, 72, 74, 76, 77, 78, 80, 82],
          borderColor: 'red',
          fill: false
        },
        {
          label: 'China',
          data: [90, 88, 86, 83, 80, 76, 70, 65, 60, 55, 52, 49, 45, 42, 40],
          borderColor: 'blue',
          fill: false
        },
        {
          label: 'USA',
          data: [20, 19, 18, 18, 17, 16, 15, 15, 14, 13, 13, 12, 12, 11, 11],
          borderColor: 'green',
          fill: false
        },
        {
          label: 'Australia',
          data: [10, 10, 9, 9, 9, 8, 8, 8, 7, 7, 7, 6, 6, 6, 6],
          borderColor: 'orange',
          fill: false
        },
        {
          label: 'Brazil',
          data: [30, 31, 32, 33, 34, 35, 35, 36, 36, 36, 35, 34, 33, 32, 31],
          borderColor: 'purple',
          fill: false
        }
      ]
    };

    const config = {
      type: 'line',
      data: data,
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'top',
          },
          title: {
            display: true,
            text: 'PM2.5 Concentration (μg/m³) Over Time by Country'
          }
        },
        scales: {
          y: {
            title: {
              display: true,
              text: 'PM2.5 (μg/m³)'
            }
          },
          x: {
            title: {
              display: true,
              text: 'Year'
            }
          }
        }
      },
    };

    new Chart(ctx, config);
  </script>
</section>

<section id="statistics" aria-label="Statistics page">
 
<!-- Ozone Pollution Line Graph (O3) - Insert this block into an existing HTML file -->

<!-- Chart.js CDN -->

<!-- Canvas for O3 chart -->
<canvas id="ozoneChart" width="800" height="400"></canvas>

<!-- Chart configuration script -->
<script>
  const ozoneCtx = document.getElementById('ozoneChart').getContext('2d');
  const ozoneChart = new Chart(ozoneCtx, {
    type: 'line',
    data: {
      labels: [
        '2010', '2012', '2014', '2016', '2018', '2020', '2022', '2024'
      ],
      datasets: [
        {
          label: 'USA (ppb)',
          data: [45, 43, 42, 41, 40, 38, 37, 36],
          borderColor: 'rgba(75, 192, 192, 1)',
          backgroundColor: 'rgba(75, 192, 192, 0.2)',
          tension: 0.3
        },
        {
          label: 'India (ppb)',
          data: [50, 52, 55, 57, 60, 62, 65, 68],
          borderColor: 'rgba(255, 99, 132, 1)',
          backgroundColor: 'rgba(255, 99, 132, 0.2)',
          tension: 0.3
        },
        {
          label: 'Germany (ppb)',
          data: [40, 39, 38, 37, 36, 35, 34, 33],
          borderColor: 'rgba(54, 162, 235, 1)',
          backgroundColor: 'rgba(54, 162, 235, 0.2)',
          tension: 0.3
        },
        {
          label: 'China (ppb)',
          data: [60, 62, 64, 65, 67, 68, 70, 71],
          borderColor: 'rgba(255, 206, 86, 1)',
          backgroundColor: 'rgba(255, 206, 86, 0.2)',
          tension: 0.3
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Ozone (O₃) Pollution Levels Over Time',
          font: {
            size: 18
          }
        },
        legend: {
          position: 'bottom'
        }
      },
      scales: {
        y: {
          title: {
            display: true,
            text: 'Ozone Concentration (ppb)'
          }
        },
        x: {
          title: {
            display: true,
            text: 'Year'
          }
        }
      }
    }
  });
</script>

 <canvas id="ozoneChart" width="0" height="0"></canvas>

</section>


  <section id="map" aria-label="Map page">

    <h2>Air Quality Map</h2>

    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
      <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <style>
      #map {
        height: 600px;
        width: 100%;
      }
      .tooltip {
        background-color: white;
        border: 1px solid #ccc;
        padding: 5px;
        border-radius: 4px;
      }
    </style>

    <div id="map"></div>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const map = L.map('map').setView([20, 0], 2);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        const cityAQIData = [
          { name: "New York", coords: [40.7128, -74.0060], aqi: 42 },
          { name: "London", coords: [51.5074, -0.1278], aqi: 55 },
          { name: "Beijing", coords: [39.9042, 116.4074], aqi: 160 },
          { name: "Delhi", coords: [28.6139, 77.2090], aqi: 190 },
          { name: "Paris", coords: [48.8566, 2.3522], aqi: 38 },
          { name: "Tokyo", coords: [35.6895, 139.6917], aqi: 50 }
        ];

        cityAQIData.forEach(city => {
          const marker = L.circleMarker(city.coords, {
            radius: 10,
            fillColor: "#FF5722",
            color: "#222",
            weight: 1,
            opacity: 1,
            fillOpacity: 0.9
          }).addTo(map);

          marker.bindTooltip(`<strong>${city.name}</strong><br>AQI: ${city.aqi}`, {
            direction: 'top',
            sticky: true,
            className: 'tooltip'
          });
        });
      });
    </script>

  </section>


</main>

<footer>© 2025 Air Pollution Awareness</footer>



<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"

  integrity="sha256-o9N1j+MiFTws7vMXCuCODlaaqItg+gFro/lN+N0LKtw="

  crossorigin=""></script>

<script>

  // Navigation handling

  const buttons = document.querySelectorAll('nav button');

  const sections = document.querySelectorAll('main section');



  function showSection(id) {

    sections.forEach(sec => {

      if (sec.id === id) {

        sec.classList.add('active');

      } else {

        sec.classList.remove('active');

      }

    });

    buttons.forEach(btn => {

      btn.classList.toggle('active', btn.id === 'nav-' + id);

    });

  }



  buttons.forEach(button => {

    button.addEventListener('click', () => {

      const id = button.id.replace('nav-', '');

      showSection(id);

      if (id === 'statistics') {

        loadStatistics();

      } else if (id === 'map') {

        setTimeout(() => { map.invalidateSize(); }, 300);

      }

    });

  });



  // AQI API and data processing

  const cities = [

    { name: "Los Angeles", coordinates: [34.0522, -118.2437] },

    { name: "Beijing", coordinates: [39.9042, 116.4074] },

    { name: "Delhi", coordinates: [28.7041, 77.1025] },

    { name: "London", coordinates: [51.5074, -0.1278] },

    { name: "Paris", coordinates: [48.8566, 2.3522] },

    { name: "Tokyo", coordinates: [35.6895, 139.6917] },

    { name: "Sydney", coordinates: [-33.8688, 151.2093] },

    { name: "Mexico City", coordinates: [19.4326, -99.1332] }

  ];



  function pm25ToAQI(pm25) {

    if (pm25 === null || pm25 === undefined) return null;

    if (pm25 <= 12) return Math.round(pm25 * 50 / 12);

    else if (pm25 <= 35.4) return Math.round(50 + (pm25 - 12) * 50 / (35.4 - 12));

    else if (pm25 <= 55.4) return Math.round(101 + (pm25 - 35.4) * 49 / (55.4 - 35.4));

    else if (pm25 <= 150.4) return Math.round(151 + (pm25 - 55.4) * 99 / (150.4 - 55.4));

    else if (pm25 <= 250.4) return Math.round(201 + (pm25 - 150.4) * 99 / (250.4 - 150.4));

    else return 301;

  }



  async function fetchCityAQI(city) {

    try {

      const response = await fetch(`https://api.openaq.org/v2/latest?city=${encodeURIComponent(city.name)}&parameter=pm25&limit=1`);

      const data = await response.json();

      if (data.results && data.results.length > 0) {

        const measurements = data.results[0].measurements;

        if (measurements && measurements.length > 0) {

          const pm25Value = measurements[0].value;

          const aqi = pm25ToAQI(pm25Value);

          return { pm25: pm25Value, aqi };

        }

      }

      return { pm25: null, aqi: null };

    } catch (error) {

      return { pm25: null, aqi: null };

    }

  }



  async function fetchHistoricalData(city) {

    try {

      const today = new Date();

      const sevenDaysAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);

      const startDate = sevenDaysAgo.toISOString();

      const endDate = today.toISOString();

      const url = `https://api.openaq.org/v2/measurements?city=${encodeURIComponent(city.name)}&parameter=pm25&date_from=${startDate}&date_to=${endDate}&limit=100&sort=asc`;

      const response = await fetch(url);

      const data = await response.json();

      if (!data.results) return [];



      const dailyMap = {};

      data.results.forEach(measurement => {

        const date = measurement.date.utc.slice(0,10);

        if (!dailyMap[date]) dailyMap[date] = [];

        dailyMap[date].push(measurement.value);

      });

      const dailyAvg = [];

      for (const date in dailyMap) {

        const values = dailyMap[date];

        const avg = values.reduce((a,b)=>a+b,0) / values.length;

        dailyAvg.push({ date, avg });

      }

      dailyAvg.sort((a,b) => a.date.localeCompare(b.date));

      return dailyAvg;

    } catch (error) {

      return [];

    }

  }



  let aqiDataCache = [];

  let historicalDataCache = [];



  async function loadStatistics() {

    if (aqiDataCache.length === 0) {

      const promises = cities.map(async (city) => {

        const data = await fetchCityAQI(city);

        return {

          name: city.name,

          pm25: data.pm25,

          aqi: data.aqi

        };

      });

      const results = await Promise.all(promises);

      aqiDataCache = results.filter(r => r.aqi !== null);

    }



    drawBarChart(aqiDataCache);



    const laCity = cities.find(c => c.name === "Los Angeles");

    if (historicalDataCache.length === 0) {

      historicalDataCache = await fetchHistoricalData(laCity);

    }

    drawLineChart(historicalDataCache);



    drawPieChart(aqiDataCache);

  }



  function drawBarChart(data) {

    const ctx = document.getElementById('aqiBarChart').getContext('2d');



    if(window.aqiBarChartInstance) {

      window.aqiBarChartInstance.destroy();

    }



    const labels = data.map(d => d.name);

    const values = data.map(d => d.aqi);



    window.aqiBarChartInstance = new Chart(ctx, {

      type: 'bar',

      data: {

        labels: labels,

        datasets: [{

          label: 'AQI (PM2.5)',

          data: values,

          backgroundColor: values.map(val => {

            if (val <= 50) return 'rgba(0, 168, 20, 0.7)';

            else if (val <= 100) return 'rgba(255, 255, 0, 0.7)';

            else if (val <= 150) return 'rgba(255, 126, 0, 0.7)';

            else if (val <= 200) return 'rgba(255, 0, 0, 0.7)';

            else if (val <= 300) return 'rgba(143, 63, 151, 0.7)';

            else return 'rgba(126, 0, 35, 0.7)';

          }),

          borderRadius: 6,

          borderSkipped: false

        }]

      },

      options: {

        responsive: true,

        scales: {

          y: {

            beginAtZero: true,

            max: 350,

            title: {

              display: true,

              text: 'AQI Level'

            }

          }

        },

        plugins: {

          legend: { display: false },

          tooltip: {

            callbacks: {

              label: ctx => {

                const idx = ctx.dataIndex;

                const city = data[idx];

                return `AQI: ${city.aqi}, PM2.5: ${city.pm25} µg/m³`;

              }

            }

          }

        }

      }

    });

  }



  function drawLineChart(historicalData) {

    const ctx = document.getElementById('aqiLineChart').getContext('2d');



    if(window.aqiLineChartInstance) {

      window.aqiLineChartInstance.destroy();

    }



    const labels = historicalData.map(d => d.date);

    const values = historicalData.map(d => pm25ToAQI(d.avg));



    window.aqiLineChartInstance = new Chart(ctx, {

      type: 'line',

      data: {

        labels: labels,

        datasets: [{

          label: "Los Angeles AQI (PM2.5) - Last 7 days",

          data: values,

          borderColor: 'rgba(0, 123, 255, 0.9)',

          backgroundColor: 'rgba(0, 123, 255, 0.3)',

          fill: true,

          tension: 0.3,

          pointRadius: 4,

          pointHoverRadius: 6,

        }]

      },

      options: {

        responsive: true,

        scales: {

          y: {

            beginAtZero: true,

            max: 350,

            title: {

              display: true,

              text: 'AQI Level'

            }

          },

          x: {

            title: {

              display: true,

              text: 'Date'

            }

          }

        },

        plugins: {

          legend: { display: true },

          tooltip: {

            callbacks: {

              label: ctx => {

                const idx = ctx.dataIndex;

                const dataPoint = historicalData[idx];

                const aqiVal = pm25ToAQI(dataPoint.avg);

                return `AQI: ${aqiVal}, PM2.5: ${dataPoint.avg.toFixed(2)} µg/m³`;

              }

            }

          }

        }

      }

    });

  }



  function getAQICategory(aqi) {

    if (aqi <= 50) return 'Good';

    else if (aqi <= 100) return 'Moderate';

    else if (aqi <= 150) return 'Unhealthy for Sensitive Groups';

    else if (aqi <= 200) return 'Unhealthy';

    else if (aqi <= 300) return 'Very Unhealthy';

    else return 'Hazardous';

  }



  function drawPieChart(data) {

    const ctx = document.getElementById('aqiPieChart').getContext('2d');



    if(window.aqiPieChartInstance) {

      window.aqiPieChartInstance.destroy();

    }



    const categoryCounts = {};

    data.forEach(city => {

      const category = getAQICategory(city.aqi);

      categoryCounts[category] = (categoryCounts[category] || 0) + 1;

    });



    const categories = Object.keys(categoryCounts);

    const counts = categories.map(cat => categoryCounts[cat]);



    const categoryColors = {

      'Good': '#00a814',

      'Moderate': '#ffff00',

      'Unhealthy for Sensitive Groups': '#ff7e00',

      'Unhealthy': '#ff0000',

      'Very Unhealthy': '#8f3f97',

      'Hazardous': '#7e0023'

    };



    const colors = categories.map(cat => categoryColors[cat] || '#cccccc');



    window.aqiPieChartInstance = new Chart(ctx, {

      type: 'pie',

      data: {

        labels: categories,

        datasets: [{

          data: counts,

          backgroundColor: colors,

          borderColor: '#fff',

          borderWidth: 2,

        }]

      },

      options: {

        responsive: true,

        plugins: {

          legend: { position: 'right' },

          tooltip: {

            callbacks: {

              label: ctx => {

                const label = ctx.label || '';

                const value = ctx.parsed || 0;

                return `${label}: ${value} city${value !== 1 ? 'ies' : ''}`;

              }

            }

          }

        }

      }

    });

  }



  const map = L.map('map').setView([20, 0], 2);



  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {

    maxZoom: 18,

    attribution: '© OpenStreetMap contributors'

  }).addTo(map);



  function getAQIColor(aqi) {

    if (aqi <= 50) return '#00a814';

    else if (aqi <= 100) return '#ffff00';

    else if (aqi <= 150) return '#ff7e00';

    else if (aqi <= 200) return '#ff0000';

    else if (aqi <= 300) return '#8f3f97';

    else return '#7e0023';

  }



  async function loadMapMarkers() {

    for (const city of cities) {

      const { pm25, aqi } = await fetchCityAQI(city);

      if (aqi === null) continue;



      const marker = L.circleMarker(city.coordinates, {

        radius: 10,

        fillColor: getAQIColor(aqi),

        color: '#000',

        weight: 1,

        opacity: 1,

        fillOpacity: 0.8

      }).addTo(map);



      marker.bindPopup(

        `<strong>${city.name}</strong><br/>AQI (PM2.5): ${aqi}<br/>PM2.5: ${pm25} µg/m³`

      );

    }

  }

  loadMapMarkers();



  if(document.querySelector('#nav-statistics').classList.contains('active')) {

    loadStatistics();

  }

</script>

</body>

</html>
